<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Temporary jobs page">
  <title>Akalia</title>
  <%- include('../partials/head.ejs'); %>

</head>

<body>
  <%- include('../partials/navbar.ejs'); %>
    <main>
      <section class=" py-4 container d-flex align-items-center justify-content-center flex-column gap-3">
        <h2 class="mb-3 fw-semibold">Productos</h2>
        
        <!-- Caja de filtros  -->
        <div class="w-100 mb-3 d-flex justify-content-center align-items-center gap-3 border rounded-3 p-2">
          <form id="filtroForm" class="row align-items-center justify-content-center">
            <!-- Ordenamiento por precio -->
            <div class="col-12 col-sm-6 col-md-3">
              <label for="ordenPrecio" class="form-label small text-muted">Ordenar precio</label>
              <select id="ordenPrecio" class="form-select form-select-sm" aria-label="Ordenar por precio">
                <option value="">-- Sin ordenar --</option>
                <option value="precio_asc">Menor a mayor</option>
                <option value="precio_desc">Mayor a menor</option>
              </select>
            </div>

            <!-- Rango mínimo -->
            <div class="col-6 col-sm-3 col-md-2">
              <label for="precioMin" class="form-label small text-muted">Precio mínimo</label>
              <input id="precioMin" type="number" min="0" class="form-control form-control-sm" placeholder="0">
            </div>

            <!-- Rango máximo -->
            <div class="col-6 col-sm-3 col-md-2">
              <label for="precioMax" class="form-label small text-muted">Precio máximo</label>
              <input id="precioMax" type="number" min="0" class="form-control form-control-sm" placeholder="100000">
            </div>

            <!-- Ubicación: departamento -->
            <div class="col-6 col-sm-3 col-md-2">
             <label for="ubicacionDepartamento" class="form-label small text-muted">Ubicación</label>
              <select class="form-select form-select-sm" id="ubicacionDepartamento" name="ubicacionEmprendimiento.departamento">
                <option value="" disabled selected>Cargando departamentos...</option>
              </select>
            </div>

            <!-- Botones aplicar/limpiar  -->
            <div class="col-12 col-md-2 d-flex flex-column  gap-2">
              <button type="button" class="btn btn-terracota" id="btnAplicarFiltros">Aplicar filtros</button>
              <button type="button" class="btn btn-basic" id="btnLimpiarFiltros">Limpiar</button>
            </div>
          </form>
        </div>


        <div class="row col-10 col-md-12 d-flex align-items-center justify-content-center mx-md-5">
          <% if (typeof productos !=='undefined' && productos.length) { %>
            <% productos.forEach(producto=> { %>
              <% /* idParaRuta: usar _id o idProducto o id según exista en el objeto */ %>
              <% const idParaRuta = producto._id || producto.idProducto || producto.id || ''; %>
              <div onclick="showProductDetail('<%= idParaRuta %>')"
                class="cursor-pointer col-12 col-sm-6 col-md-4 col-lg-3 mb-4 d-flex align-items-stretch">
                <article class="card rounded-0 border-0 w-100 h-100">
                  <% /* Buscar imagen por id del producto (normalizar a string para comparar) */ %>
                  <% const img = imagenes.find(img => String(img.idProducto) === String(producto._id || producto.idProducto || producto.id)); %>
                    <% if(img) { %>
                      <!-- Mostrar la imagen encontrada, recortada con object-fit para mantener proporción -->
                      <img src="<%= img.urlImagen %>" class="card-img-top img-fluid rounded-0"
                        style="height:200px; object-fit:cover;" alt="<%= producto.nombreProducto %>" />
                      <% } else { %>
                        <!-- Si no hay imagen asociada, mostrar placeholder -->
                        <img
                          src="https://img.freepik.com/vector-premium/icono-marco-fotos-foto-vacia-blanco-vector-sobre-fondo-transparente-aislado-eps-10_399089-1290.jpg"
                          class="card-img-top img-fluid rounded-0"
                          style="height:200px; object-fit:cover;" alt="<%= producto.nombreProducto %>" />
                        <% } %>
                          <!-- <%= producto.imagenProducto %> -->
                          <div class="card-body bg-light d-flex flex-column">
                            <h5 class="card-title  mb-1 text-truncate w-100">
                              <%= producto.tituloProducto %>
                            </h5>
                            <p class="card-text text-muted mb-2 text-truncate w-100">
                              <%= producto.descripcionProducto %>
                            </p>
                            <p class="fw-semibold text-dark mb-0 mt-auto">
                              $ <%= producto.precio %>
                            </p>
                          </div>
                </article>
              </div>
              <% }); %>
                <% } else { %>
                  <li><span>Sin productos</span></li>
                  <% } %>
        </div>
      </section>

    </main>
  
    <!-- FOOTER-->
    <%- include('../partials/footer.ejs'); %>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
      <!-- Script para cargar departamentos/ciudades -->
      <script src="/js/ubicaciones.service.js"></script>
      <script src="/js/filtros.js"></script>


</body>
<%- include('../partials/modal-login.ejs'); %>
  <%- include('../partials/modal-signup.ejs'); %>


</html>